<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ profile.user.username }}'s Profile</title>
</head>
<body>
    <h2>{{ profile.user.username }}'s Profile</h2>

    <!-- Display Follower Count -->
    <p><strong>Followers:</strong> {{ count_followers }}</p>

    <!-- Follow/Unfollow Button -->
    {% if user.is_authenticated %}
        {% if user != profile.user %}
            {% if is_following %}
                <form method="POST" action="{% url 'unfollow_user' profile.user.id %}">
                    {% csrf_token %}
                    <button type="submit">Unfollow</button>
                </form>
            {% else %}
                <form method="POST" action="{% url 'follow_user' profile.user.id %}">
                    {% csrf_token %}
                    <button type="submit">Follow</button>
                </form>
            {% endif %}
        {% endif %}
    {% else %}
        <p><a href="{% url 'login' %}">Log in</a> to follow users.</p>
    {% endif %}

    <!-- Profile Picture -->
    {% if profile.user.profile_picture %}
        <img src="{{ profile.user.profile_picture.url }}" alt="Profile Picture" width="150">
    {% else %}
        <p>No profile picture uploaded.</p>
    {% endif %}

    <!-- Display Bio -->
    <p><strong>Bio:</strong> {{ profile.bio }}</p>

    <!-- Filters for Subject and Grade -->
    <form method="GET">
        <label for="grade_level">Filter by Grade:</label>
        <select name="grade_level" id="grade_level">
            <option value="">Filter by Grade</option>
            {% for grade_value, grade_label in GRADE_CHOICES %}
                <option value="{{ grade_value }}" {% if grade_filter == grade_value %}selected{% endif %}>
                    {{ grade_label }}
                </option>
            {% endfor %}
        </select>

        <label for="subject">Filter by Subject:</label>
        <select name="subject" id="subject">
            <option value="">Filter by Subject</option>
            {% for subject_value, subject_label in SUBJECT_CHOICES %}
                <option value="{{ subject_value }}" {% if subject_filter == subject_value %}selected{% endif %}>
                    {{ subject_label }}
                </option>
            {% endfor %}
        </select>

        <button type="submit">Apply Filters</button>
    </form>

    <!-- Public Notes Section -->
    <h3>Public Notes</h3>
    <ul>
        {% for note in notes %}
            <li>
                <h3>{{ note.title }}</h3>
                <p><strong>Grade:</strong> {{ note.grade_level }} | <strong>Subject:</strong> {{ note.subject }}</p>
                <p>{{ note.content }}</p>
                {% if note.file %}
                    <p><a href="{{ note.file.url }}" download><button>ðŸ“¥ Download Attachment</button></a></p>
                {% endif %}
            </li>
        {% empty %}
            <p>No public notes available.</p>
        {% endfor %}
    </ul>

    <!-- Back to Notes -->
    <a href="{% url 'notes_list' %}"><button>Go to Notes</button></a>
</body>
</html>